<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1400 1000">
  <!-- Background -->
  <rect width="1400" height="1000" fill="#f8f9fa"/>
  
  <!-- Title -->
  <text x="700" y="30" text-anchor="middle" font-family="Arial, sans-serif" font-size="22" font-weight="bold" fill="#2c3e50">Course Materials RAG System - Process Flow</text>
  
  <!-- Document Ingestion Process -->
  <rect x="50" y="60" width="650" height="420" rx="15" fill="#e8f5e8" stroke="#4caf50" stroke-width="3"/>
  <text x="375" y="85" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#2e7d32">Document Ingestion Process</text>
  
  <!-- Start -->
  <ellipse cx="150" cy="130" rx="60" ry="25" fill="#4caf50" stroke="#2e7d32" stroke-width="2"/>
  <text x="150" y="135" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">START</text>
  
  <!-- Step 1: Scan docs folder -->
  <rect x="75" y="180" width="150" height="50" rx="8" fill="#c8e6c9" stroke="#4caf50" stroke-width="2"/>
  <text x="150" y="200" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#2e7d32">Scan /docs folder</text>
  <text x="150" y="215" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#2e7d32">Find .pdf/.docx/.txt files</text>
  
  <!-- Decision: Course exists? -->
  <polygon points="150,250 200,275 150,300 100,275" fill="#ffcc02" stroke="#f57c00" stroke-width="2"/>
  <text x="150" y="270" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#e65100">Course</text>
  <text x="150" y="285" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#e65100">exists?</text>
  
  <!-- Skip path -->
  <rect x="275" y="250" width="100" height="50" rx="8" fill="#ffecb3" stroke="#ffa000" stroke-width="2"/>
  <text x="325" y="270" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#e65100">Skip</text>
  <text x="325" y="285" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#e65100">Existing</text>
  
  <!-- Step 2: Process document -->
  <rect x="75" y="330" width="150" height="50" rx="8" fill="#c8e6c9" stroke="#4caf50" stroke-width="2"/>
  <text x="150" y="350" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#2e7d32">Process Document</text>
  <text x="150" y="365" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#2e7d32">Extract course/lesson info</text>
  
  <!-- Step 3: Create chunks -->
  <rect x="275" y="330" width="150" height="50" rx="8" fill="#c8e6c9" stroke="#4caf50" stroke-width="2"/>
  <text x="350" y="350" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#2e7d32">Create Text Chunks</text>
  <text x="350" y="365" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#2e7d32">800 chars, 100 overlap</text>
  
  <!-- Step 4: Generate embeddings -->
  <rect x="475" y="330" width="150" height="50" rx="8" fill="#c8e6c9" stroke="#4caf50" stroke-width="2"/>
  <text x="550" y="350" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#2e7d32">Generate Embeddings</text>
  <text x="550" y="365" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#2e7d32">MiniLM-L6-v2 model</text>
  
  <!-- Step 5: Store in ChromaDB -->
  <rect x="275" y="410" width="200" height="50" rx="8" fill="#c8e6c9" stroke="#4caf50" stroke-width="2"/>
  <text x="375" y="430" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#2e7d32">Store in ChromaDB</text>
  <text x="375" y="445" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#2e7d32">Catalog + Content collections</text>
  
  <!-- Query Processing -->
  <rect x="750" y="60" width="600" height="500" rx="15" fill="#e3f2fd" stroke="#1976d2" stroke-width="3"/>
  <text x="1050" y="85" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#1565c0">Query Processing Flow</text>
  
  <!-- Start Query -->
  <ellipse cx="850" cy="130" rx="60" ry="25" fill="#1976d2" stroke="#1565c0" stroke-width="2"/>
  <text x="850" y="135" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">User Query</text>
  
  <!-- Step 1: Receive via API -->
  <rect x="775" y="180" width="150" height="50" rx="8" fill="#bbdefb" stroke="#1976d2" stroke-width="2"/>
  <text x="850" y="200" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#1565c0">FastAPI Endpoint</text>
  <text x="850" y="215" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#1565c0">/api/query</text>
  
  <!-- Step 2: Create/Get Session -->
  <rect x="975" y="180" width="150" height="50" rx="8" fill="#bbdefb" stroke="#1976d2" stroke-width="2"/>
  <text x="1050" y="200" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#1565c0">Session Manager</text>
  <text x="1050" y="215" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#1565c0">Get/create session</text>
  
  <!-- Step 3: RAG System -->
  <rect x="775" y="260" width="150" height="50" rx="8" fill="#bbdefb" stroke="#1976d2" stroke-width="2"/>
  <text x="850" y="280" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#1565c0">RAG System</text>
  <text x="850" y="295" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#1565c0">Orchestrate query</text>
  
  <!-- Step 4: AI Generator -->
  <rect x="975" y="260" width="150" height="50" rx="8" fill="#bbdefb" stroke="#1976d2" stroke-width="2"/>
  <text x="1050" y="280" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#1565c0">AI Generator</text>
  <text x="1050" y="295" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#1565c0">Claude API call</text>
  
  <!-- Decision: Need search? -->
  <polygon points="850,340 900,365 850,390 800,365" fill="#ffcc02" stroke="#f57c00" stroke-width="2"/>
  <text x="850" y="360" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#e65100">Need course</text>
  <text x="850" y="375" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#e65100">search?</text>
  
  <!-- Tool Search Path -->
  <rect x="1000" y="340" width="120" height="50" rx="8" fill="#fff3e0" stroke="#f57c00" stroke-width="2"/>
  <text x="1060" y="360" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#e65100">Search Tool</text>
  <text x="1060" y="375" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#e65100">Query vector DB</text>
  
  <!-- Step 5: Course Resolution -->
  <rect x="1150" y="280" width="130" height="70" rx="8" fill="#fff3e0" stroke="#f57c00" stroke-width="2"/>
  <text x="1215" y="305" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#e65100">Course Resolution</text>
  <text x="1215" y="320" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#e65100">Match course name</text>
  <text x="1215" y="335" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#e65100">via semantic search</text>
  
  <!-- Step 6: Content Search -->
  <rect x="1150" y="370" width="130" height="70" rx="8" fill="#fff3e0" stroke="#f57c00" stroke-width="2"/>
  <text x="1215" y="395" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#e65100">Content Search</text>
  <text x="1215" y="410" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#e65100">Find relevant</text>
  <text x="1215" y="425" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#e65100">chunks + metadata</text>
  
  <!-- Step 7: Generate Response -->
  <rect x="775" y="450" width="150" height="50" rx="8" fill="#bbdefb" stroke="#1976d2" stroke-width="2"/>
  <text x="850" y="470" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#1565c0">Generate Response</text>
  <text x="850" y="485" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#1565c0">Claude + context</text>
  
  <!-- Step 8: Update History -->
  <rect x="975" y="450" width="150" height="50" rx="8" fill="#bbdefb" stroke="#1976d2" stroke-width="2"/>
  <text x="1050" y="470" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#1565c0">Update History</text>
  <text x="1050" y="485" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#1565c0">Save Q&A to session</text>
  
  <!-- End -->
  <ellipse cx="1050" cy="530" rx="60" ry="25" fill="#4caf50" stroke="#2e7d32" stroke-width="2"/>
  <text x="1050" y="535" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">Return Response</text>
  
  <!-- Data Flow Section -->
  <rect x="50" y="600" width="1300" height="150" rx="15" fill="#fff8e1" stroke="#ffa000" stroke-width="3"/>
  <text x="700" y="625" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#e65100">Data Structures & Flow</text>
  
  <!-- Data boxes -->
  <rect x="80" y="650" width="180" height="80" rx="8" fill="#ffecb3" stroke="#ffa000" stroke-width="2"/>
  <text x="170" y="670" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#e65100">Course Model</text>
  <text x="170" y="685" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#e65100">• title, instructor</text>
  <text x="170" y="700" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#e65100">• lessons[], course_link</text>
  <text x="170" y="715" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#e65100">• metadata structure</text>
  
  <rect x="300" y="650" width="180" height="80" rx="8" fill="#ffecb3" stroke="#ffa000" stroke-width="2"/>
  <text x="390" y="670" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#e65100">CourseChunk Model</text>
  <text x="390" y="685" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#e65100">• content (800 chars)</text>
  <text x="390" y="700" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#e65100">• course_title</text>
  <text x="390" y="715" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#e65100">• lesson_number, index</text>
  
  <rect x="520" y="650" width="180" height="80" rx="8" fill="#ffecb3" stroke="#ffa000" stroke-width="2"/>
  <text x="610" y="670" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#e65100">ChromaDB Collections</text>
  <text x="610" y="685" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#e65100">• course_catalog</text>
  <text x="610" y="700" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#e65100">• course_content</text>
  <text x="610" y="715" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#e65100">• embeddings + metadata</text>
  
  <rect x="740" y="650" width="180" height="80" rx="8" fill="#ffecb3" stroke="#ffa000" stroke-width="2"/>
  <text x="830" y="670" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#e65100">Search Results</text>
  <text x="830" y="685" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#e65100">• documents[]</text>
  <text x="830" y="700" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#e65100">• metadata[]</text>
  <text x="830" y="715" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#e65100">• distances[], sources</text>
  
  <rect x="960" y="650" width="180" height="80" rx="8" fill="#ffecb3" stroke="#ffa000" stroke-width="2"/>
  <text x="1050" y="670" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#e65100">API Response</text>
  <text x="1050" y="685" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#e65100">• answer (string)</text>
  <text x="1050" y="700" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#e65100">• sources[]</text>
  <text x="1050" y="715" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#e65100">• session_id</text>
  
  <!-- Tool Integration Box -->
  <rect x="1180" y="650" width="170" height="80" rx="8" fill="#ffecb3" stroke="#ffa000" stroke-width="2"/>
  <text x="1265" y="670" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#e65100">Tool Integration</text>
  <text x="1265" y="685" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#e65100">• CourseSearchTool</text>
  <text x="1265" y="700" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#e65100">• ToolManager</text>
  <text x="1265" y="715" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#e65100">• Claude function calls</text>
  
  <!-- Configuration and Notes -->
  <rect x="50" y="780" width="1300" height="100" rx="15" fill="#f3e5f5" stroke="#7b1fa2" stroke-width="3"/>
  <text x="700" y="805" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#6a1b9a">Configuration & Key Settings</text>
  
  <text x="80" y="830" font-family="Arial, sans-serif" font-size="12" fill="#6a1b9a">• <tspan font-weight="bold">Chunk Size:</tspan> 800 characters with 100 character overlap</text>
  <text x="80" y="850" font-family="Arial, sans-serif" font-size="12" fill="#6a1b9a">• <tspan font-weight="bold">Embedding Model:</tspan> all-MiniLM-L6-v2 (SentenceTransformers)</text>
  <text x="80" y="870" font-family="Arial, sans-serif" font-size="12" fill="#6a1b9a">• <tspan font-weight="bold">AI Model:</tspan> Claude Sonnet 4 with temperature=0 for consistency</text>
  
  <text x="750" y="830" font-family="Arial, sans-serif" font-size="12" fill="#6a1b9a">• <tspan font-weight="bold">Max Results:</tspan> 5 chunks per search query</text>
  <text x="750" y="850" font-family="Arial, sans-serif" font-size="12" fill="#6a1b9a">• <tspan font-weight="bold">Session History:</tspan> 2 conversation exchanges maximum</text>
  <text x="750" y="870" font-family="Arial, sans-serif" font-size="12" fill="#6a1b9a">• <tspan font-weight="bold">Storage:</tspan> ChromaDB persistent client with SQLite backend</text>
  
  <!-- Flow Arrows -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#666"/>
    </marker>
  </defs>
  
  <!-- Document Ingestion Arrows -->
  <line x1="150" y1="155" x2="150" y2="180" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="150" y1="230" x2="150" y2="250" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="200" y1="275" x2="275" y2="275" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="235" y="270" font-family="Arial, sans-serif" font-size="10" fill="#e65100">Yes</text>
  <line x1="150" y1="300" x2="150" y2="330" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="135" y="320" font-family="Arial, sans-serif" font-size="10" fill="#2e7d32">No</text>
  <line x1="225" y1="355" x2="275" y2="355" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="425" y1="355" x2="475" y2="355" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="550" y1="380" x2="375" y2="410" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Query Processing Arrows -->
  <line x1="850" y1="155" x2="850" y2="180" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="925" y1="205" x2="975" y2="205" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="850" y1="230" x2="850" y2="260" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="925" y1="285" x2="975" y2="285" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="850" y1="310" x2="850" y2="340" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="900" y1="365" x2="1000" y2="365" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="940" y="355" font-family="Arial, sans-serif" font-size="10" fill="#e65100">Yes</text>
  <line x1="1120" y1="365" x2="1150" y2="315" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="1215" y1="350" x2="1215" y2="370" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="1150" y1="405" x2="925" y2="470" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="925" y1="475" x2="975" y2="475" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="1050" y1="500" x2="1050" y2="505" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Direct path for non-search queries -->
  <line x1="850" y1="390" x2="850" y2="450" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="815" y="420" font-family="Arial, sans-serif" font-size="10" fill="#1565c0">No</text>
  
  <!-- Data flow arrows -->
  <line x1="260" y1="690" x2="300" y2="690" stroke="#ffa000" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="480" y1="690" x2="520" y2="690" stroke="#ffa000" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="700" y1="690" x2="740" y2="690" stroke="#ffa000" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="920" y1="690" x2="960" y2="690" stroke="#ffa000" stroke-width="2" marker-end="url(#arrowhead)"/>
  
</svg>